/**
 * Provides a toolbar button and a dialog to add pasted html code for embed remote media,
 * or uploaded flv choose with file Browser played by  into edited contents.
 *
 * @author Vincent Mazenod   
 * @see doc on http://forge.clermont-universite.fr/wiki/ckmedia 
 * @see Based on http://github.com/n1k0/ckMedia 
 * @see Based on http://github.com/n1k0/ckMediaEmbed
 * @license
 *  
 */(function(){function s(e,t){i[e]=t}function o(){code="<script type='text/javascript' src='"+i.swfobject+"'></script>\n";code+="<div id='"+i.div_id+"'><img src='"+i.replacement+"' width='"+i.width+"' height='"+i.height+"'/></div>\n";code+="<script id='"+i.div_id+"_script' type='text/javascript'>\n";code+="  var so = new SWFObject('"+i.player+"','"+i.player_id+"','"+i.width+"','"+i.height+"','"+i.version+"');\n";code+="  so.addParam('allowfullscreen','"+i.allowfullscreen+"');\n";code+="  so.addParam('allowscriptaccess','"+i.allowscriptaccess+"');\n";code+="  so.addParam('wmode','"+i.wmode+"');\n";for(option in i)i[option]&&option!="div_id"&&option!="player"&&option!="player_id"&&option!="width"&&option!="height"&&option!="version"&&option!="allowfullscreen"&&option!="allowscriptaccess"&&option!="wmode"&&option!="swfobject"&&option!="yt"&&(code+="  so.addVariable('"+option+"','"+i[option]+"');\n");code+="  so.write('"+i.div_id+"');\n";code+="</script>\n";return code}var e=CKEDITOR.basePath.split("/");e=e.slice(3);var t="";for(var n=0;n<e.length;n++)t=t+"/"+e[n];var r=new Date,i={player:t+"plugins/media/mediaplayer-5.4/player.swf",replacement:t+"plugins/media/images/replacement.gif",swfobject:t+"plugins/media/mediaplayer-5.4/swfobject.js",yt:t+"plugins/media/mediaplayer-5.4/yt.swf",player_id:"player_"+r.getTime(),div_id:"media_"+r.getTime(),version:"9",allowfullscreen:"true",allowscriptaccess:"always",wmode:"opaque",plugins:"gapro-1","gapro.accountid":"UA-XXXXXXX-X",width:"320",height:"180",file:"",image:"",author:"",description:"",duration:"",start:"",title:"",provider:"",playlistfile:"",playlist:"",playlistsize:"",backcolor:"",frontcolor:"",lightcolor:"",screencolor:"",controlbar:"",dock:"",skin:"",autostart:"",bufferlength:"",icons:"",item:"",mute:"",quality:"",repeat:"",shuffle:"",stretching:"",volume:"",linktarget:"",streamer:""};CKEDITOR.plugins.add("media",{init:function(e){CKEDITOR.dialog.add("MediaDialog",function(e){return{title:"Media",minWidth:500,minHeight:100,onLoad:function(){dialog=this},contents:[{id:"code",label:"Embed Media Code",expand:!0,elements:[{type:"textarea",id:"Code_"+e.name,rows:20}]},{id:"single",label:"Single Media File",expand:!0,elements:[{type:"hbox",align:"center",widths:["80%","20%"],children:[{id:"MediaFile_"+e.name,type:"text","default":i.file,onBlur:function(){s("file",this.getDialog().getContentElement("single","MediaFile_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Movie / Media File"},{id:"BrowseMediaFile_"+e.name,type:"button",hidden:!0,filebrowser:{action:"Browse",onSelect:function(t,n){this.getDialog().getContentElement("single","MediaFile_"+e.name).setValue(t);s("file",this.getDialog().getContentElement("single","MediaFile_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())}},label:"browse server",style:"margin-top: 12px; float:right"}]},{type:"hbox",align:"center",widths:["80%","20%"],children:[{id:"MediaImage_"+e.name,type:"text","default":i.image,onBlur:function(){s("image",this.getDialog().getContentElement("single","MediaImage_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Preview Image"},{id:"BrowseMediaImage_"+e.name,type:"button",hidden:!0,filebrowser:{action:"Browse",onSelect:function(t,n){this.getDialog().getContentElement("single","MediaImage_"+e.name).setValue(t);s("image",this.getDialog().getContentElement("single","MediaImage_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())}},label:"browse server",style:"margin-top: 12px; float:right"}]},{type:"hbox",align:"center",widths:["50%","50%"],children:[{type:"vbox",children:[{id:"MediaWidth_"+e.name,type:"text","default":i.width,onBlur:function(){s("width",this.getDialog().getContentElement("single","MediaWidth_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Width (px)"},{id:"MediaHeight_"+e.name,type:"text","default":i.height,onBlur:function(){s("height",this.getDialog().getContentElement("single","MediaHeight_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Height (px)"},{id:"MediaDuration_"+e.name,type:"text","default":i.duration,onBlur:function(){s("duration",this.getDialog().getContentElement("single","MediaDuration_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Duration"},{id:"MediaStart_"+e.name,type:"text","default":i.start,onBlur:function(){s("start",this.getDialog().getContentElement("single","MediaStart_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Start"}]},{type:"vbox",children:[{id:"MediaAuthor_"+e.name,type:"text","default":i.author,onBlur:function(){s("author",this.getDialog().getContentElement("single","MediaAuthor_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Author"},{id:"MediaDescription_"+e.name,type:"text","default":i.description,onBlur:function(){s("description",this.getDialog().getContentElement("single","MediaDescription_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Description"},{id:"MediaTitle_"+e.name,type:"text","default":i.title,onBlur:function(){s("title",this.getDialog().getContentElement("single","MediaTitle_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"title"},{id:"MediaProvider_"+e.name,type:"text","default":i.provider,onBlur:function(){s("provider",this.getDialog().getContentElement("single","MediaProvider_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Provider"}]}]}]},{id:"playlist",label:"Media Playlist",expand:!0,elements:[{type:"hbox",align:"center",widths:["80%","20%"],children:[{id:"PlaylistFile_"+e.name,type:"text","default":i.playlistfile,onBlur:function(){s("playlistfile",this.getDialog().getContentElement("playlist","PlaylistFile_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Playlist Url"},{id:"BrowsePlaylistFile_"+e.name,type:"button",hidden:!0,filebrowser:{action:"Browse",onSelect:function(t,n){this.getDialog().getContentElement("playlist","PlaylistFile_"+e.name).setValue(t);s("playlistfile",this.getDialog().getContentElement("playlist","PlaylistFile_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())}},label:"browse server",style:"margin-top: 12px; float:right"}]},{type:"hbox",align:"center",widths:["50%","50%"],children:[{type:"vbox",children:[{id:"PlaylistWidth_"+e.name,type:"text",labelLayout:"horizontal","default":i.width,onBlur:function(){s("width",this.getDialog().getContentElement("playlist","PlaylistWidth_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Width (px)"},{id:"PlaylistHeight_"+e.name,type:"text",labelLayout:"horizontal","default":i.height,onBlur:function(){s("height",this.getDialog().getContentElement("playlist","PlaylistHeight_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Height (px)"}]},{type:"vbox",children:[{id:"PlaylistView_"+e.name,type:"select",labelLayout:"horizontal","default":i.playlist,onBlur:function(){s("playlist",this.getDialog().getContentElement("playlist","PlaylistView_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["none","none"],["bottom","bottom"],["over","over"],["right","right"],["left","left"],["top","top"]],label:"playlist view"},{id:"PlaylistSize_"+e.name,type:"text",labelLayout:"horizontal","default":i.playlistsize,onBlur:function(){s("playlistsize",this.getDialog().getContentElement("playlist","PlaylistSize_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"playlist size (px)"}]}]}]},{id:"player",label:"Player options",expand:!0,elements:[{type:"hbox",align:"center",widths:["50%","50%"],children:[{type:"vbox",children:[{type:"html",html:"Layout"},{id:"PlayerControlbar_"+e.name,type:"select",labelLayout:"horizontal","default":i.controlbar,onBlur:function(){s("controlbar",this.getDialog().getContentElement("player","PlayerControlbar_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["bottom","bottom"],["top","top"],["over","over"],["none","none"]],label:"Controlbar"},{id:"PlayerDock_"+e.name,type:"select",labelLayout:"horizontal","default":i.dock,onBlur:function(){s("dock",this.getDialog().getContentElement("player","PlayerDock_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["true","true"],["false","false"]],label:"Dock"},{id:"PlayerSkin_"+e.name,type:"text",labelLayout:"horizontal","default":i.skin,onBlur:function(){s("skin",this.getDialog().getContentElement("player","PlayerSkin_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Skin"},{type:"html",html:"Colors"},{id:"PlayerBackcolor_"+e.name,type:"text",labelLayout:"horizontal","default":i.backcolor,onBlur:function(){s("backcolor",this.getDialog().getContentElement("player","PlayerBackcolor_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Backcolor"},{id:"PlayerFrontcolor_"+e.name,type:"text",labelLayout:"horizontal","default":i.frontcolor,onBlur:function(){s("frontcolor",this.getDialog().getContentElement("player","PlayerFrontcolor_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Frontcolor"},{id:"PlayerLightcolor_"+e.name,type:"text",labelLayout:"horizontal","default":i.lightcolor,onBlur:function(){s("lightcolor",this.getDialog().getContentElement("player","PlayerLightcolor_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Lightcolor"},{id:"PlayerScreencolor_"+e.name,type:"text",labelLayout:"horizontal","default":i.screencolor,onBlur:function(){s("screencolor",this.getDialog().getContentElement("player","PlayerScreencolor_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Screencolor"}]},{type:"vbox",children:[{type:"html",html:"Behaviour"},{id:"PlayerAutostart_"+e.name,type:"select",labelLayout:"horizontal","default":i.autostart,onBlur:function(){s("autostart",this.getDialog().getContentElement("player","PlayerAutostart_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["false","false"],["true","true"]],label:"Autostart"},{id:"PlayerBufferLength_"+e.name,type:"text",labelLayout:"horizontal","default":i.bufferlength,onBlur:function(){s("bufferlength",this.getDialog().getContentElement("player","PlayerBufferLength_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Buffer length"},{id:"PlayerIcons_"+e.name,type:"select",labelLayout:"horizontal","default":i.icons,onBlur:function(){s("icons",this.getDialog().getContentElement("player","PlayerIcons_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["true","true"],["false","false"]],label:"Icons"},{id:"PlayerItem_"+e.name,type:"text",labelLayout:"horizontal","default":i.item,onBlur:function(){s("item",this.getDialog().getContentElement("player","PlayerItem_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Item"},{id:"PlayerMute_"+e.name,type:"select",labelLayout:"horizontal","default":i.mute,onBlur:function(){s("mute",this.getDialog().getContentElement("player","PlayerMute_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["false","false"],["true","true"]],label:"Mute"},{id:"PlayerQuality_"+e.name,type:"select",labelLayout:"horizontal","default":i.quality,onBlur:function(){s("quality",this.getDialog().getContentElement("player","PlayerQuality_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["true","true"],["false","false"]],label:"Quality"},{id:"PlayerRepeat_"+e.name,type:"select",labelLayout:"horizontal","default":i.repeat,onBlur:function(){s("repeat",this.getDialog().getContentElement("player","PlayerRepeat_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["none","none"],["list","list"],["always","always"]],label:"Repeat"},{id:"PlayerShuffle_"+e.name,type:"select",labelLayout:"horizontal","default":i.shuffle,onBlur:function(){s("shuffle",this.getDialog().getContentElement("player","PlayerShuffle_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["false","false"],["true","true"]],label:"Shuffle"},{id:"PlayerStretching_"+e.name,type:"select",labelLayout:"horizontal","default":i.stretching,onBlur:function(){s("stretching",this.getDialog().getContentElement("player","PlayerStretching_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},items:[["uniform","uniform"],["fill","fill"],["exactfit","exactfit"],["none","none"]],label:"Stretching"},{id:"PlayerVolume_"+e.name,type:"text",labelLayout:"horizontal","default":i.volume,onBlur:function(){s("volume",this.getDialog().getContentElement("player","PlayerVolume_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Volume"}]}]},{id:"PlayerLinktarget_"+e.name,type:"text",labelLayout:"horizontal","default":i.linktarget,onBlur:function(){s("linktagret",this.getDialog().getContentElement("player","PlayerLinktarget_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Linktarget"},{id:"PlayerPlugins_"+e.name,type:"text",labelLayout:"horizontal","default":i.plugins,onBlur:function(){s("plugins",this.getDialog().getContentElement("player","PlayerPlugins_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Plugins"},{id:"PlayerGAProAccountId_"+e.name,type:"text",labelLayout:"horizontal","default":i["gapro.accountid"],onBlur:function(){s("plugins",this.getDialog().getContentElement("player","PlayerGAProAccountId_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Google Analytics Acount Id (UA-XXXXXXX-X)"},{id:"PlayerStreamer_"+e.name,type:"text",labelLayout:"horizontal","default":i.streamer,onBlur:function(){s("streamer",this.getDialog().getContentElement("player","PlayerStreamer_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"Streamer"},{id:"PlayerPlayerId_"+e.name,type:"text",labelLayout:"horizontal","default":i.player_id,onBlur:function(){s("player_id",this.getDialog().getContentElement("player","PlayerPlayerId_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"player id"},{id:"PlayerDivId_"+e.name,type:"text",labelLayout:"horizontal","default":i.div_id,onBlur:function(){s("div_id",this.getDialog().getContentElement("player","PlayerPlayerId_"+e.name).getValue());this.getDialog().getContentElement("code","Code_"+e.name).setValue(o())},label:"div id"}]}],onOk:function(){e.insertHtml("<div id='"+i.div_id+"_box'>"+dialog.getContentElement("code","Code_"+e.name).getValue()+"</div>")}}});e.addCommand("Media",new CKEDITOR.dialogCommand("MediaDialog"));e.ui.addButton("Media",{label:"Media",command:"Media",icon:this.path+"images/add.gif"});e.addMenuItems&&e.addMenuItems({removeMedia:{label:"Media",command:"removeMedia",icon:this.path+"images/remove.gif",group:"removeMedia"}});e.addCommand("removeMedia",new CKEDITOR.removeMedia);e.contextMenu&&e.contextMenu.addListener(function(e,t){return!e||!e.is("img")||e.getId()==e.getParent().getId()?null:{removeMedia:CKEDITOR.TRISTATE_OFF}})}})})();CKEDITOR.removeMedia=function(){};CKEDITOR.removeMedia.prototype={exec:function(e){e.getSelection().getSelectedElement().getParent().getParent().remove()}};