/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */(function(){function r(e,t){var n=e.config.useComputedState,r;n=n===undefined||n;n||(r=s(t.lastElement,e.editable()));r=r||t.block||t.blockLimit;if(r.equals(e.editable())){var i=e.getSelection().getRanges()[0].getEnclosedNode();i&&i.type==CKEDITOR.NODE_ELEMENT&&(r=i)}if(!r)return;var o=n?r.getComputedStyle("direction"):r.getStyle("direction")||r.getAttribute("dir");e.getCommand("bidirtl").setState(o=="rtl"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);e.getCommand("bidiltr").setState(o=="ltr"?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}function i(e,t){var n=t.block||t.blockLimit||e.editable(),r=n.getDirection(1);if(r!=(e._.selDir||e.lang.dir)){e._.selDir=r;e.fire("contentDirChanged",r)}}function s(e,t){while(e&&!(e.getName()in n||e.equals(t))){var r=e.getParent();if(!r)break;e=r}return e}function o(e,t,n,r){if(e.isReadOnly()||e.equals(n.editable()))return;CKEDITOR.dom.element.setMarker(r,e,"bidi_processed",1);var i=e,s=n.editable();while((i=i.getParent())&&!i.equals(s))if(i.getCustomData("bidi_processed")){e.removeStyle("direction");e.removeAttribute("dir");return}var o="useComputedState"in n.config?n.config.useComputedState:1,u=o?e.getComputedStyle("direction"):e.getStyle("direction")||e.hasAttribute("dir");if(u==t)return;e.removeStyle("direction");if(o){e.removeAttribute("dir");t!=e.getComputedStyle("direction")&&e.setAttribute("dir",t)}else e.setAttribute("dir",t);n.forceNextSelectionCheck();return}function u(e,t,n){var r=e.getCommonAncestor(!1,!0);e=e.clone();e.enlarge(n==CKEDITOR.ENTER_BR?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS);if(e.checkBoundaryOfElement(r,CKEDITOR.START)&&e.checkBoundaryOfElement(r,CKEDITOR.END)){var i;while(r&&r.type==CKEDITOR.NODE_ELEMENT&&(i=r.getParent())&&i.getChildCount()==1&&!(r.getName()in t))r=i;return r.type==CKEDITOR.NODE_ELEMENT&&r.getName()in t&&r}}function a(n){return{context:"p",refresh:function(e,t){r(e,t);i(e,t)},exec:function(r){var i=r.getSelection(),s=r.config.enterMode,a=i.getRanges();if(a&&a.length){var f={},l=i.createBookmarks(),c=a.createIterator(),h,p=0;while(h=c.getNextRange(1)){var d=h.getEnclosedNode();if(!d||d&&!(d.type==CKEDITOR.NODE_ELEMENT&&d.getName()in t))d=u(h,e,s);d&&o(d,n,r,f);var v,m,g=new CKEDITOR.dom.walker(h),y=l[p].startNode,b=l[p++].endNode;g.evaluator=function(t){return!!(t.type==CKEDITOR.NODE_ELEMENT&&t.getName()in e&&(t.getName()!=(s==CKEDITOR.ENTER_P?"p":"div")||t.getParent().type!=CKEDITOR.NODE_ELEMENT||t.getParent().getName()!="blockquote")&&t.getPosition(y)&CKEDITOR.POSITION_FOLLOWING&&(t.getPosition(b)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_CONTAINS)==CKEDITOR.POSITION_PRECEDING)};while(m=g.next())o(m,n,r,f);v=h.createIterator();v.enlargeBr=s!=CKEDITOR.ENTER_BR;while(m=v.getNextParagraph(s==CKEDITOR.ENTER_P?"p":"div"))o(m,n,r,f)}CKEDITOR.dom.element.clearAllMarkers(f);r.forceNextSelectionCheck();i.selectBookmarks(l);r.focus()}}}}function f(e){var t=e.getDocument().getBody().getParent();while(e){if(e.equals(t))return!1;e=e.getParent()}return!0}function l(e){var t=e==c.setAttribute,n=e==c.removeAttribute,r=/\bdirection\s*:\s*(.*?)\s*(:?$|;)/;return function(i,s){if(!this.isReadOnly()){var o;if((i==(t||n?"dir":"direction")||i=="style"&&(n||r.test(s)))&&!f(this)){o=this.getDirection(1);var u=e.apply(this,arguments);if(o!=this.getDirection(1)){this.getDocument().fire("dirChanged",this);return u}}}return e.apply(this,arguments)}}var e={table:1,ul:1,ol:1,blockquote:1,div:1},t={},n={};CKEDITOR.tools.extend(t,e,{tr:1,p:1,div:1,li:1});CKEDITOR.tools.extend(n,t,{td:1});CKEDITOR.plugins.add("bidi",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",icons:"bidiltr,bidirtl",init:function(e){function t(t,n,r,i,s){e.addCommand(r,new CKEDITOR.command(e,i));e.ui.addButton&&e.ui.addButton(t,{label:n,command:r,toolbar:"bidi,"+s})}if(e.blockless)return;var n=e.lang.bidi;e.ui.addToolbarGroup&&e.ui.addToolbarGroup("bidi","align","paragraph");t("BidiLtr",n.ltr,"bidiltr",a("ltr"),10);t("BidiRtl",n.rtl,"bidirtl",a("rtl"),20);e.on("contentDom",function(){e.document.on("dirChanged",function(t){e.fire("dirChanged",{node:t.data,dir:t.data.getDirection(1)})})});e.on("contentDirChanged",function(t){var n=(e.lang.dir!=t.data?"add":"remove")+"Class",r=e.ui.space(e.config.toolbarLocation);r&&r[n]("cke_mixed_dir_content")})}});var c=CKEDITOR.dom.element.prototype,h=["setStyle","removeStyle","setAttribute","removeAttribute"];for(var p=0;p<h.length;p++)c[h[p]]=CKEDITOR.tools.override(c[h[p]],l)})();