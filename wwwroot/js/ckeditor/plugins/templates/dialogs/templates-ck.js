/**
 * @license Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.html or http://ckeditor.com/license
 */(function(){var e=CKEDITOR.document;CKEDITOR.dialog.add("templates",function(e){function t(e,t){e.setHtml("");for(var r=0,i=t.length;r<i;r++){var s=CKEDITOR.getTemplates(t[r]),o=s.imagesPath,u=s.templates,a=u.length;for(var f=0;f<a;f++){var l=u[f],c=n(l,o);c.setAttribute("aria-posinset",f+1);c.setAttribute("aria-setsize",a);e.append(c)}}}function n(e,t){var n=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),i='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';e.image&&t&&(i+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(t+e.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>');i+='<td style="white-space:normal;"><span class="cke_tpl_title">'+e.title+"</span><br/>";e.description&&(i+="<span>"+e.description+"</span>");i+="</td></tr></table>";n.getFirst().setHtml(i);n.on("click",function(){r(e.html)});return n}function r(t){var n=CKEDITOR.dialog.getCurrent(),r=n.getValueOf("selectTpl","chkInsertOpt");if(r){e.fire("saveSnapshot");e.setData(t,function(){n.hide();var t=e.createRange();t.moveToElementEditStart(e.editable());t.select();setTimeout(function(){e.fire("saveSnapshot")},0)})}else{e.insertHtml(t);n.hide()}}function i(e){var t=e.data.getTarget(),n=o.equals(t);if(n||o.contains(t)){var r=e.data.getKeystroke(),i=o.getElementsByTag("a"),s;if(i){if(n)s=i.getItem(0);else switch(r){case 40:s=t.getNext();break;case 38:s=t.getPrevious();break;case 13:case 32:t.fire("click")}if(s){s.focus();e.data.preventDefault()}}}}var s=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(s.path+"dialogs/templates.css"));var o,u="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),a=e.lang.templates,f=e.config;return{title:e.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:a.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+a.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+u+'">'+'<div class="cke_tpl_loading"><span></span></div>'+"</div>"+'<span class="cke_voice_label" id="'+u+'">'+a.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:a.insertOption,"default":f.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var e=this.getContentElement("selectTpl","templatesList");o=e.getElement();CKEDITOR.loadTemplates(f.templates_files,function(){var n=(f.templates||"default").split(",");if(n.length){t(o,n);e.focus()}else o.setHtml('<div class="cke_tpl_empty"><span>'+a.emptyListMsg+"</span>"+"</div>")});this._.element.on("keydown",i)},onHide:function(){this._.element.removeListener("keydown",i)}}})})();